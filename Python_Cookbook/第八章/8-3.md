## 8-3. 让一个对象支持上下文管理器

**问题**

你想要你得对象支持上下文管理器的协议（就是可以用 with 语句）。

**解决方案**

想要让对象适配 with 语句，你需要实现 __enter__() 和 __exit__() 方法。比如，下面事一个提供网络链接的类：

    >>> from socket import socket, AF_INET, SOCK_STREAM
    >>> class LazyConnection:
            def __init__(self, address, family=AF_INET, type=SOCK_STREAM):
                slef.address = address
                self.family = AF_INET
                self.type = SOCK_STREAM
                self.sock = None
            def __enter__(self):
                if self.sock is not None:
                    raise RuntimeError('已经链接上了！')
                self.sock = socket(self.family, self.type)
                self.sock.connect(self.address)
                return self.sock
            def __exit__(self, exc_ty, exc_val, tb):
                self.sock.close()
                self.sock = None



**讨论**

